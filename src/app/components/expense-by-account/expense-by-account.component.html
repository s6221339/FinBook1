<div class="expense-by-account-page">
  <!-- å¹´æœˆç¯©é¸å™¨ -->
  <div class="filter-section">
    <div class="filter-group">
      <label for="year">å¹´ä»½ï¼š</label>
      <select id="year" [(ngModel)]="selectedYear" (change)="onYearChange()">
        @for(y of years; track $index) {
          <option [value]="y">{{ y }} å¹´</option>
        }
      </select>
    </div>
    <div class="filter-group">
      <label for="month">æœˆä»½ï¼š</label>
      <select id="month" [(ngModel)]="selectedMonth" (change)="onMonthChange()">
        @for(m of months; track $index) {
          <option [value]="m">{{ m }}æœˆ</option>
        }
      </select>
    </div>
  </div>

  <!-- åœ“é¤…åœ– -->
  <div class="chart-section">
    @if(filteredBalances.length > 0) {
      <canvas baseChart
        [data]="pieChartDataSet"
        [type]="'pie'"
        [options]="pieChartOptions">
      </canvas>
    }
    @else {
      <div class="no-data">
        <p>ğŸ“­ æœ¬æœˆå°šç„¡æ”¯å‡ºè³‡æ–™</p>
      </div>
    }
  </div>

  <!-- æ”¯å‡ºæ‘˜è¦ -->
  <div class="summary-section">
    <div class="summary-item">
      <span class="summary-label">åˆè¨ˆï¼š</span>
      <span class="summary-value">{{ totalExpense | number:'1.0-0' }} å…ƒ</span>
    </div>
    <div class="summary-item">
      <span class="summary-label">å¹³å‡æ¯å¤©ï¼š</span>
      <span class="summary-value">{{ getAveragePerDay() | number:'1.0-0' }} å…ƒ</span>
    </div>
  </div>
  <!-- æ”¯å‡ºæ˜ç´°è¡¨æ ¼ -->
   @if(filteredBalances.length > 0) {
    <div class="table-section">
      <table>
        <thead>
          <tr>
            <th>å¸³æˆ¶</th>
            <th>é‡‘é¡</th>
            <th>æ¯”ä¾‹</th>
          </tr>
        </thead>
        <tbody>
          @for(b of filteredBalances; track $index) {
            <tr>
              <td class="label-cell">
                <span class="color-dot" [style.background]="pieChartColors[$index % pieChartColors.length]"></span>
                {{ b.name }}
              </td>
              <td [style.color]="pieChartColors[$index % pieChartColors.length]">
                {{ b.outlay | number:'1.0-0' }} å…ƒ
              </td>
              <td [style.color]="pieChartColors[$index % pieChartColors.length]">
                {{ totalExpense == 0 ? '0.0' : ((b.outlay / totalExpense) * 100) | number:'1.1-1' }} ï¼…
              </td>
            </tr>
          }
        </tbody>
      </table>
      @if(totalExpense == 0) {
        <div class="zero-expense-note">
          âš ï¸ æ‰€æœ‰å¸³æˆ¶æœ¬æœˆæ”¯å‡ºçš†ç‚º 0 å…ƒï¼Œç„¡å¯¦éš›èŠ±è²»ç´€éŒ„ã€‚
        </div>
      }
    </div>
   }
</div>
