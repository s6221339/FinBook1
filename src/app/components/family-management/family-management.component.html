<div>
  <div>
    <h2>家庭管理</h2>
  </div>
  <div>
    <h3>功能列表：</h3><br>

    @if(isOwner){
      <button (click)="renameFamilyName()">更改家庭名稱</button>
      <button (click)="inviteMember()">邀請</button>
      <button (click)="removeSelectedMembers()">踢除</button>
      <button (click)="transferFamilyOwner()">轉讓族長</button>
      <button (click)="disbandFamily()">解散</button>
    }
    <button (click)="leaveFamily()">退出</button>
  </div>
  @if(familyData){
    <div>
      <h3>家庭名稱：{{ displayFamilyName }}</h3>
      <h3>
        擁有者：
        <img [src]="familyData.owner.avatar" alt="擁有者頭像" width="32" height="32" style="border-radius: 50%; vertical-align: middle; margin-right: 8px;" onerror="this.onerror=null;this.src='/defaultavatar.jpg';"/>
        {{ familyData.owner.name }}
      </h3>
      <h3 style="display: inline-block;">家庭成員：</h3>
      @if(isOwner){
        <button
          (click)="toggleInviteList()"
          style="display: inline-block; margin-left: 8px;"
          >
            {{ showInviteList ? '隱藏邀請中清單' : '顯示邀請中清單' }}
        </button>
        <!-- 收合區域 -->
        @if(showInviteList){
          <div
            class="inviting-list"
            style="margin-top: 12px; padding: 10px; border: 1px solid #ccc; border-radius: 8px;"
          >
            <h4>邀請中成員：</h4>
            @if(invitingMembers.length > 0){
              <ul style="list-style: none; padding-left: 0;">
                @for(member of invitingMembers; track $index){
                  <li style="display: flex; align-items: center; margin-bottom: 8px;">
                    <img [src]="member.avatar" alt="邀請中頭像" width="32" height="32" style="border-radius: 50%; margin-right: 8px;" onerror="this.onerror=null;this.src='/defaultavatar.jpg';"/>
                    <span>{{ member.name }}</span>
                    <button (click)="cancelInvite(member.account)" style="margin-left: 12px;">❌取消邀請</button>
                  </li>
                }
              </ul>
            }
            @else {
              <p style="color: gray">目前無邀請中成員</p>
            }
          </div>
        }
      }

      @if(familyData.memberList.length > 0){
        @if(isOwner){
          <div>
            <label>
              <input type="checkbox" [checked]="isAllSelected" (change)="toggleSelectAll(($event))"/>
              全選
            </label>
          </div>
        }
        <ul>
          @for(member of familyData.memberList; track $index){
            <li>
              @if(isOwner){
                <label>
                  <input
                    type="checkbox"
                    [checked]="selectedAccounts.has(member.account)"
                    (change)="onToggleMember(member.account, $event)"
                  />
                  <img [src]="member.avatar" alt="成員頭像" width="32" height="32" style="border-radius: 50%; margin-right: 8px;" onerror="this.onerror=null;this.src='/defaultavatar.jpg';"/>
                  {{ member.name }}
                </label>
              }
              @else {
                <img [src]="member.avatar" alt="成員頭像" width="32" height="32" style="border-radius: 50%; margin-right: 8px;" onerror="this.onerror=null;this.src='/defaultavatar.jpg';"/>
                {{ member.name }}
              }
            </li>
          }
        </ul>
      }
      @else {
        <p style="color: gray;">尚無家庭成員</p>
      }
    </div>
  }
  @else {
    <div>
      <p>找不到指定的家庭資料</p>
    </div>
  }

</div>
