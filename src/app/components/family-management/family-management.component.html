<div>
  <div>
    <h2>家庭管理</h2>
  </div>
  <div>
    <h3>功能列表：</h3><br>

    @if(isOwner){
      <button (click)="renameFamilyName()">更改家庭名稱</button>
      <button (click)="inviteMember()">邀請</button>
      <button (click)="removeSelectedMembers()">踢除</button>
      <button (click)="transferFamilyOwner()">轉讓族長</button>
      <button (click)="disbandFamily()">解散</button>
    }
    <button (click)="leaveFamily()">退出</button>
  </div>
  @if(familyData){
    <div>
      <h3>家庭名稱：{{ displayFamilyName }}</h3>
      <h3>擁有者：{{ familyData.owner.name }}（{{ familyData.owner.account }}）</h3>
      <h3 style="display: inline-block;">家庭成員：</h3>
      @if(isOwner){
        <button
          (click)="toggleInviteList()"
          style="display: inline-block; margin-left: 8px;"
          >
            {{ showInviteList ? '隱藏邀請中清單' : '顯示邀請中清單' }}
        </button>
        <!-- 收合區域 -->
        @if(showInviteList){
          <div
            class="inviting-list"
            style="margin-top: 12px; padding: 10px; border: 1px solid #ccc; border-radius: 8px;"
          >
            <h4>邀請中成員：</h4>
            @if(invitingMembers.length > 0){
              <ul>
                @for(member of invitingMembers; track $index){
                  <li>
                    {{ member.name }}（{{ member.account }}）
                    <button (click)="cancelInvite(member.account)" style="margin-left: 12px;">❌取消邀請</button>
                  </li>
                }
              </ul>
            }
            @else {
              <p style="color: gray">目前無邀請中成員</p>
            }
          </div>
        }
      }

      @if(familyData.memberList.length > 0){
        <div>
          <label>
            <input type="checkbox" [checked]="isAllSelected" (change)="toggleSelectAll(($event))"/>
            全選
          </label>
        </div>
        <ul>
          @for(member of familyData.memberList; track $index){
            <li>
              <label>
                <input
                  type="checkbox"
                  [checked]="selectedAccounts.has(member.account)"
                  (change)="onToggleMember(member.account, $event)"
                />
                {{ member.name }}（{{ member.account }}）
              </label>
            </li>
          }
        </ul>
      }
      @else {
        <p style="color: gray;">尚無家庭成員</p>
      }
    </div>
  }
  @else {
    <div>
      <p>找不到指定的家庭資料</p>
    </div>
  }

</div>
