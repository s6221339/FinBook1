<div class="page-container">
  <div class="invitations-card">
    <div class="card-header">
      <mat-icon>swap_horiz</mat-icon>
      <h3>待確認轉帳</h3>
      <div class="action-buttons">
        <span class="invitation-count pill-orange">{{ totalRecords }} 筆待確認</span>
      </div>
    </div>

    <div class="card-content">
      @if (dataSource.data.length === 0) {
        <div class="empty-state">
          <mat-icon>check_circle_outline</mat-icon>
          <h3>目前沒有待處理的轉帳</h3>
        </div>
      } @else {
        <div class="table-container">
          <table mat-table [dataSource]="pagedData" class="invitations-table">

            <!-- From Name Column -->
            <ng-container matColumnDef="fromName">
              <th mat-header-cell *matHeaderCellDef> 轉帳者 </th>
              <td mat-cell *matCellDef="let element"> {{element.fromName}} </td>
            </ng-container>

            <!-- Amount Column -->
            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef> 額度 </th>
              <td mat-cell *matCellDef="let element"> NT$ {{element.amount | number}} </td>
            </ng-container>

            <!-- Description Column -->
            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef> 描述 </th>
              <td mat-cell *matCellDef="let element"> {{element.description || '（無）'}} </td>
            </ng-container>

            <!-- Create Date Column -->
            <ng-container matColumnDef="createDate">
              <th mat-header-cell *matHeaderCellDef> 轉移日期 </th>
              <td mat-cell *matCellDef="let element"> {{element.createDate | date:'yyyy/MM/dd'}} </td>
            </ng-container>

            <!-- Select Account Column -->
            <ng-container matColumnDef="selectAccount">
              <th mat-header-cell *matHeaderCellDef> 選擇帳戶 </th>
              <td mat-cell *matCellDef="let element">
                <select [(ngModel)]="element.selectedBalanceId" class="custom-select">
                  @for (b of balanceList; track b.balanceId) {
                    <option [value]="b.balanceId">
                      {{ b.name || ('帳戶 ID：' + b.balanceId) }}
                    </option>
                  }
                </select>
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef> 操作 </th>
              <td mat-cell *matCellDef="let element">
                <div class="button-group">
                  <button (click)="accept(element)" class="accept-btn" aria-label="Accept invitation">
                    <mat-icon>check</mat-icon>
                    <span>接受</span>
                  </button>
                  <button (click)="reject(element.transfersId)" class="reject-btn" aria-label="Reject invitation">
                    <mat-icon>close</mat-icon>
                    <span>拒絕</span>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>

        <app-custom-paginator
          [totalItems]="totalRecords"
          [currentPage]="currentPage"
          [pageSize]="pageSize"
          (pageChange)="onPageChange($event)"
          (pageSizeChange)="onPageSizeChange($event)">
        </app-custom-paginator>
      }
    </div>
  </div>
</div>
